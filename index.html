<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù‚Ø§Ù…ÙˆØ³ÙŠ</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>

<body>

<h2>ğŸ“˜ Ø§Ù„Ù‚Ø§Ù…ÙˆØ³</h2>

<button onclick="login()">Login Pi</button>
<br><br>
<button onclick="pay()">Ø§Ø¯ÙØ¹ 1 Pi</button>
  <br><br>
<input id="search" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø©">
<button onclick="find()">Ø¨Ø­Ø«</button>
<h3 id="result"></h3>

<p id="user"></p>

<script src="https://sdk.minepi.com/pi-sdk.js"></script>

<script>
Pi.init({ version: "2.0", sandbox: true });
// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyASAhqVjPc-Hb4gyMBlgiuTYYulOtUCrso",
  authDomain: "cloudmall-dictionary.firebaseapp.com",
  projectId: "cloudmall-dictionary",
  storageBucket: "cloudmall-dictionary.firebasestorage.app",
  messagingSenderId: "244388055728",
  appId: "1:244388055728:web:824837bb2bb408a6848975"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
let currentUser = null;

/* ===== LOGIN ===== */
async function login() {
  try {
    const scopes = ['username','payments'];
    const auth = await Pi.authenticate(scopes, onIncompletePaymentFound);

    currentUser = auth.user;
    document.getElementById("user").innerText =
      "Ù…Ø±Ø­Ø¨Ø§ " + auth.user.username;

  } catch (err) {
    alert("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    console.log(err);
  }
}

/* ===== PAYMENT ===== */
function pay() {
  if (!currentUser) {
    alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§ÙˆÙ„");
    return;
  }

  const paymentData = {
    amount: 1,
    memo: "Unlock dictionary",
    metadata: { item: "dictionary" }
  };

  const callbacks = {
    onReadyForServerApproval: (paymentId) => {
      console.log(paymentId);
    },
    onReadyForServerCompletion: (paymentId, txid) => {
      console.log(paymentId, txid);
    },
    onCancel: () => {
      alert("ØªÙ… Ø§Ù„ØºØ§Ø¡ Ø§Ù„Ø¯ÙØ¹");
    },
    onError: (error) => {
      console.log(error);
    }
  };

  Pi.createPayment(paymentData, callbacks);
}

function onIncompletePaymentFound(payment) {
  console.log(payment);
}
</script>async function find(){
  const word = document.getElementById("search").value;

  const snap = await db.collection("dictionary")
    .where("word","==", word)
    .get();

  if(snap.empty){
    document.getElementById("result").innerText = "Ø§Ù„ÙƒÙ„Ù…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©";
  } else {
    snap.forEach(doc => {
      document.getElementById("result").innerText = doc.data().meaning;
    });
  }
}

</body>
</html>
