<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù‚Ø§Ù…ÙˆØ³ÙŠ</title>
</head>

<body>

<h2>ğŸ“˜ Ø§Ù„Ù‚Ø§Ù…ÙˆØ³</h2>

<button onclick="login()">Login Pi</button>
<br><br>
<button onclick="pay()">Ø§Ø¯ÙØ¹ 1 Pi</button>

<p id="user"></p>

<script src="https://sdk.minepi.com/pi-sdk.js"></script>

<script>
Pi.init({ version: "2.0", sandbox: true });

let currentUser = null;

/* ===== LOGIN ===== */
async function login() {
  try {
    const scopes = ['username','payments'];
    const auth = await Pi.authenticate(scopes, onIncompletePaymentFound);

    currentUser = auth.user;
    document.getElementById("user").innerText =
      "Ù…Ø±Ø­Ø¨Ø§ " + auth.user.username;

  } catch (err) {
    alert("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    console.log(err);
  }
}

/* ===== PAYMENT ===== */
function pay() {
  if (!currentUser) {
    alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§ÙˆÙ„");
    return;
  }

  const paymentData = {
    amount: 1,
    memo: "Unlock dictionary",
    metadata: { item: "dictionary" }
  };

  const callbacks = {
    onReadyForServerApproval: (paymentId) => {
      console.log(paymentId);
    },
    onReadyForServerCompletion: (paymentId, txid) => {
      console.log(paymentId, txid);
    },
    onCancel: () => {
      alert("ØªÙ… Ø§Ù„ØºØ§Ø¡ Ø§Ù„Ø¯ÙØ¹");
    },
    onError: (error) => {
      console.log(error);
    }
  };

  Pi.createPayment(paymentData, callbacks);
}

function onIncompletePaymentFound(payment) {
  console.log(payment);
}
</script>

</body>
</html>
